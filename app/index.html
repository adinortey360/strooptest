<html>

<head>
    <title>StroopTest</title>
</head>

<body>
    <div class="welcome">
        <h1>Welcome to StroopTest</h1>
        <p>In this test, you will be presented with 15 colored words. You will need to read the word aloud without
            mentioning the color of the text.</p>
        <p>You will need to take this test in a quiet room free of distraction. We will estimate your risk by voice
            recognition and give you a score.</p>
        <button onclick="displayWord()">Take the test now</button>
    </div>

    <div class="test">
        <h1 id="wordandcolor">red</h1>
    </div>


    <p>Click on the below button and speak something...</p>
    <p><span id="action"></span></p>
    <div id="output" class="hide"></div>

    <script src="https://code.jquery.com/jquery-migrate-3.4.0.min.js"></script>
    <script>
        var colors = [
            {
                "colorname": "Red",
                "colorcode": "#FF0000"
            },
            {
                "colorname": "Purple",
                "colorcode": "#6a0dad"
            },
        ]

        var results = []
        var i = 0;
        var stage = 1;

        function displayWord() {

            if(stage > 1) {
                i = (colors.length*2)-(i+1)-1;
            }

            console.log(i);

            $("#wordandcolor").html("<span style='color:" + colors[i].colorcode + "'>" + colors[i].colorname + "</span>");


            var output = document.getElementById("output");
            var action = document.getElementById("action");
            var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
            var recognition = new SpeechRecognition();

            recognition.onstart = function () {
                action.innerHTML = "<small>listening...</small>";
            };

            recognition.onspeechend = function () {
                action.innerHTML = "<small>done...</small>";
                recognition.stop();
            }

            recognition.onresult = function (event) {
                var transcript = event.results[0][0].transcript;
                var confidence = event.results[0][0].confidence;

                output.innerHTML = "<b>Transcript:</b> " + transcript + "<br/> <b>Confidence:</b> " + confidence * 100 + "%";
                output.classList.remove("hide");

                if (transcript.toUpperCase() === colors[i].colorname.toUpperCase()) {
                    console.log("Correct");
                    results.push({result: 1, stage: stage});
                } else {
                    results.push({result: 0, stage: stage});
                }


                if (i + 1 < colors.length) {
                    i++;

                    if(i+1 > colors.length && stage == 1) {
                        stage++;
                        
                        console.log("stage now"+stage.toString());

                        if(stage > 2) {
                            console.log("looop done");
                            console.log(results);
                        }
                    }
                }
                else {
                    
                    console.log(results)
                }


                displayWord();
            };

            recognition.start();

        }


    </script>
</body>

</html>